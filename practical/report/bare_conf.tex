\documentclass[11pt]{article}
\usepackage[pdftex]{graphicx}
\usepackage{amsmath}
 \usepackage[margin=3cm]{geometry}
\usepackage{booktabs}
\usepackage{xcolor}
\usepackage{listings}
\usepackage{multicol}

\usepackage{fancyhdr}

\pagestyle{fancy}
\fancyhf{}
\chead{Practical report Group 14: Broker – 21MN15}
\cfoot{Page \thepage}

%\lstset{basicstyle=\ttfamily,
%	showstringspaces=false,
%	commentstyle=\color{red},
%	keywordstyle=\color{blue}
%}
\usepackage{array}
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\usepackage{biblatex}
\usepackage[colorlinks=true,allcolors=black]{hyperref}
%\usepackage[backend=biber, bibencoding=utf8, style=ieee]{biblatex}
\addbibresource{references.bib}

\begin{document}
\title{Practical Report Group 14: Broker\\ {\fontsize{13}{0}\selectfont Internet of Things (2IMN15) 2016-2017, Eindhoven University of Technology}}

\author{Sai Krishna Kalluri, TU/e, Netherlands, 
		Email: saikrishh.kalluri@gmail.com \& \\  Snorri Stefansson, TU/e, Netherlands, Email: snorriste@gmail.com}
\maketitle



\begin{abstract}
	This practical assignment for the course IoT involves creating a lightning system controlled and managed by different but relevant wireless protocols and separated individual applications. The architecture and development of this system will be the topic of this report.\\	
\end{abstract}
\pagebreak
\tableofcontents

\pagebreak

\section{Group Members}
\begin{table}[htbp]
	\caption{}
	\begin{tabular}{lcllc}
		\toprule
		No & Name & Student ID & Email & Master Program \\ 
		\midrule
		1 & Sai Krishna Kalluri & 1035631 & s.k.kalluri@student.tue.nl & ES \\ 
		2 & Snorri Stefansson & 1033995 & s.stefansson@student.tue.nl & ES \\ 
		\toprule
	\end{tabular}
	\label{}
\end{table}

\section{Group Partners}
\begin{table}[htbp]
	\caption{}
	\centering
	\begin{tabular}{llL{2cm}L{5cm}lc}
		\toprule
		No & Group No  &  Part  & Group Member’s Name and Email & StudID & Program \\ 
		\midrule
		1 & 11 & End Device & \textbf{Christoforos Boukouvalas} \newline c.boukouvalas@student.tue.nl & 0832600 &  \\ 
		&  11& End Device & \textbf{Nikos Avramis} \newline avramisn@gmail.com & 1115964 & AT \\ 
		\midrule
		2 & 10 & Cloud & \textbf{Michalis Kapsalakis}\newline m.kapsalakis@student.tue.nl  & 0979557” & IST \\ 
		& 10 & Cloud & \textbf{Tho Le Phuoc} \newline thole020287@gmail.com &  & CS \\ 
		\toprule
	\end{tabular}
	\label{}
\end{table}



\section{System Description - Understanding the application}

Creating a lighting system with an IoT architecture may sound like an overkill, yet when the application and architecture is designed carefully it becomes essential in everyday life. This system will be described as it will be tested in the final plug fest of this course. The light system is composed of; four lights, each with a user, a user application with a UI, a sensor to detect the users presence, a manager, his web manager UI. These are the most important physical components which allow for a complete system to be operated. 



\section{System Interfaces}
There are three groups which develop this system as stated in Figure \ref{fig:fig1}.
Each team has their purpose. This is the report of the broker, thus will be written with that perspective. Two other teams complete the total assignment, they are cloud group and end-device group and will be references as that through out the report. To shortly describe the relationship with these groups and their purpose; The cloud group is basically responsible of bookkeeping of all information important for the system and the end-device group is responsible of maintaining lights and sensors in the systems which define end device. The end device will present light upon request of the user and be able to detect a user with a camera, sensor. The exact purpose of each team will also come into the protocol and information data exchange related to the modules such as Leshan and MQTT.
\begin{figure}[h]
	\begin{center}
		\includegraphics[width=1\linewidth]{img/design}
		\caption{This Figure is from the lecture slides on IoT \cite{slides}}
		\label{fig:fig1}
	\end{center}
\end{figure}


\section{Implementation, Architecture and Protocols}

There are four significant deliverables for the broker group. Each of them 
\begin{enumerate}
	\item There is a user app for the user to control the light/s, which was selected to be a Android app for this showcase.
	\item mDNS discovery service. Avahi was chosen for this job and is built into linux or can be used with python for integration into a python project.
	\item LWM2M (Rest API) - a 'light weight machine to machine communication' with end device as well as maintaining a CoAP/HTTP server. Leshan was chosen for this task and is written in Java.
	\item MQTT broker which allows lights and sensors to communicate basic commands between one and other with this well suited subscribe and publish service. Mosquitto version 1.4.8 was used for this and installed on linux.
\end{enumerate}

\textit{A laptop with Ubuntu 16.04 64-bit was used to run all these modules except the Android app which was run with an emulator and designed on a Windows computer.}

The architecture is somewhat predefined but many design options were left up to the teams. All communication and information will pass through the broker on its way to the endpoint.

\begin{figure}[h]
	\begin{center}
		\includegraphics[width=0.6\linewidth]{img/overview}
		\caption{}
		\label{fig:fig2}
	\end{center}
\end{figure}

\input{lwm2m}

\subsection{mDNS: Avahi broker}
mDNS stands for Multicast Domain Name System and it can inform other devices on the same network of the IP of the host. It uses the same structure as DNS but it is a zero configuration service. Avahi implements this zero configuration network discovery profile. On linux Avahi is already installed an requires no extra installation. Both the cloud and end device need to take advantage of this service and can retrieve the IP address with discovery, thus then connecting to the remaining system such a MQTT or Leshan. Figure \ref{fig:avahi} shows how this can be done.

\begin{figure}[h]
	\begin{center}
		\includegraphics[width=1.1\linewidth]{img/avahi}
		\caption{The bash command for running the avahi client on linux}
		\label{fig:avahi}
	\end{center}
\end{figure}


For embedding this into Java, Python or any other high level programming language, it is possible to call the bash command with a 'OS' library and read the output. Setting this up on the broker only required running on startup. Problems during the development were mostly related to port and firewall issues with the laptop or network connection.

\subsection{MQTT: Mosquitto}
MQTT stands for MQ Telemetry Transport and is a very light weight publish and subscribe protocol. The Mosquitto broker is installed on the linux machine and then the clients can both publish messages to topics and subscribe to the topics as well. This module worked seamlessly after install. In the testing section it can be observed how messages are published (this is only for making sure from the broker side that the MQTT broker is working).

\input{prod}
\input{disc}
\input{eval}
\input{refl}
\input{cont}

\printbibliography

\end{document}